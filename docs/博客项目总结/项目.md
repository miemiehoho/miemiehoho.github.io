[学习视频](https://www.bilibili.com/video/BV1Gb4y1d7zb?p=18)

# 前端服务

启动服务

```
npm install   #安装依赖
npm run build  #构建
npm run dev		#启动
npm start#q
```

# 后端项目

1、项目搭建

2、文章列表

3、最热标签

4、统一异常处理

5、最热文章

6、最新文章

7、文章归档

8、登录-JWT技术

9、登录

10、登录后获取用户信息

11、退出登录

12、注册

13、登录拦截器

14、ThreadLocal 保存用户信息

15、文章详情

16、线程池的使用：使用线程池更新view_count, 文章详情很快的显示出来，不受线程池的影响

17、阅读次数 bug 修正

18、评论列表

19、评论功能

20、文章分类

21、文章标签

22、发布文章

23、AOP记录日志 - （**技术亮点**）

24、图片上传

25、导航-文章分类

26、标签文章列表

27、归档文章列表

28、统一缓存处理 

29、统一缓存 精度丢失bug修复

30、缓存一致性问题

RocketMQ解决修改文章内容等产生的缓存一致性问题，好处：整个过程是解耦的

1. 安装 rocketmq

   ```shell
   #docker 拉取
   docker pull foxiswho/rocketmq:4.8.0
   #启动nameserver
   docker run -d  \
         --name rmqnamesrv \
         --restart=always \
         -v /mydata/rocketmq/data/namesrv/logs:/root/logs \
   	  -v /mydata/rocketmq/data/namesrv/store:/root/store \
         -e "JAVA_OPT_EXT=-Xms512M -Xmx512M -Xmn128m" \
         -p 9876:9876 \
         foxiswho/rocketmq:4.8.0 \
         sh mqnamesrv
   ```

   

   ```shell
   mkdir -p  /mydata/rocketmq/data/broker/logs   /mydata/rocketmq/data/broker/store /mydata/rocketmq/conf
   ```

   

   ```shell
   vi /docker/rocketmq/conf/broker.conf
   ```

   ```shell
   #broker.conf
   brokerIP1=192.168.19.134
   namesrvAddr=192.168.19.134:9876
   brokerName=broker_all
   ```

   

   ```shell
   #启动broker
   docker run -d \
         --name rmqbroker \
         --restart=always \
         -v /mydata/rocketmq/data/broker/logs:/usr/local/rocketmq/logs \
         -v /mydata/rocketmq/data/broker/store:/usr/local/rocketmq/store \
         -v /mydata/rocketmq/conf/:/usr/local/rocketmq/conf \
         -e "NAMESRV_ADDR=192.168.19.134:9876" \
         -e "JAVA_OPT_EXT=-Xms512M -Xmx512M -Xmn128m" \
         -p 10911:10911 -p 10912:10912 -p 10909:10909 \
         foxiswho/rocketmq:4.8.0 \
         sh mqbroker -c /usr/local/rocketmq/conf/broker.conf
   ```

   ```shell
   #rocketmq-console-ng
   docker run --name rmqconsole --link rmqnamesrv:rmqnamesrv \
   -e "JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.19.134:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false" \
   -p 8180:8080 -t styletang/rocketmq-console-ng  \
   --restart=always 
   ```

   

2. #启动访问 http://192.168.19.134:8180/

```shell
# 自启动
docker update rmqnamesrv --restart=always
docker update rmqbroker --restart=always
docker update rmqconsole --restart=always
```

	3. 集成

```xml
    <dependency>
        <groupId>org.apache.rocketmq</groupId>
        <artifactId>rocketmq-spring-boot-starter</artifactId>
        <version>2.2.0</version>
    </dependency>
```

4. 添加对应的配置：

~~~properties
#rocketmq配置
rocketmq.name-server=192.168.200.100:9876
rocketmq.producer.group=blog_group # 生产者所属组（可以组成集群，提高效率）
~~~

 	5. 代码：

31、缓存一致性问题-文章列表

文章列表的缓存不知道参数，解决办法

1. 直接删除缓存，重新进行缓存
2. 直接不对文章列表做缓存

# 项目优化

1. 文章可以放入es中，便于后序中文分词搜索
2. 评论数据，可以考虑放入mongodb当中（评论数据这种松散化的数据适合放入mongodb中，mongodb适合存储松散化数据，而且mongodb拓展性也非常强，查询效率也还是比较快的（电商系统中，一般评论数据就是放入mongodb中的）
3. 阅读数和评论数，可以考虑增加的时候放入redis，incr自增，（redis没有线程安全问题），使用定时任务定时把数据固化到数据库中（如果不用redis，即使加了多线程，并发量大的时候还是会有线程安全问题）
4. 为了加快访问速度，部署的时候可以把图片、js、css等放入七牛云存储，加快网站访问速度







# 管理后台项目

做一个后台，用springsecurity做一个权限系统，对工作帮助比较大



域名注册、备案、部署

1、 CURD

2、集成 security

	1. 新建 spring security 配置文件
	1. 实现spring security认证功能（登录功能）
	3. 实现权限认证
	 	1. 数据库中有一张 admin和 permission的关联表，通过admin_id 获取对应的permission_id,再获取对应的path，然后和请求路径进行比对来确认是否有权限
	4. 添加角色，一个角色拥有多个权限，用户拥有多个角色

# 总结

1. jwt + redis

   1. token 令牌的登录方法，好处：访问速度快（不用保存session），session共享，安全性可以得到保证
   2. redis 做了令牌和用户信息的对应关系管理，
      1. 第二重验证，进一步增加了安全性
      2. 对登录用户做了缓存
         1. 灵活控制用户的过期（可以实现续期、踢掉线等功能，用redis实现）
2. threadLocal 使用了保存用户信息，请求的线程之内，可以随时获取登录的用户，做了线程隔离（多个用户之间不会互相产生影响）
3. 在 使用完threadLocal后，做了value的删除，防止了内存泄漏
4. 线程安全 - update table set value  = newValue  where id = 1 **and value = oldvalue** (使用这种sql语句保证了一定能够执行成功：能保证在原有旧值的基础上更新为新值，而不会出现多个线程的情况下更新不到正确结果的情况，也就是解决了并发的线程安全问题)
5. 线程池 - 应用非常广，面试 

   1. 7个核心参数

      1. 线程核心参数
      2. 最大线程数
      3. 线程存活时间（针对救急线程）
      4. 时间单位
      5. 线程工厂
      6. 阻塞队列
      7. 拒绝策略
   2. 应用：
   
      1. （①对当前主业务流程无影响的操作，放入线程池执行，加快效率；
      2.  ②记录日志：比如登录时候记录日志，日志记录是否成功，不能影响用户登录，应该放入线程池）
6. 权限系统 （重点内容）
7. 统一日志记录，统一缓存处理

​      





### rocketmq  docker安装

构建namesrv容器

```
docker run -d \
--name rmqnamesrv \
-p 9876:9876 \
-v /mydata/rocketmq/data/namesrv/logs:/root/logs \
-v /mydata/rocketmq/data/namesrv/store:/root/store \
-e "MAX_POSSIBLE_HEAP=100000000" \
foxiswho/rocketmq:4.8.0 \
sh mqnamesrv 	
```

创建broker节点

```
mkdir -p  /mydata/rocketmq/data/broker/logs   /mydata/rocketmq/data/broker/store /mydata/rocketmq/conf
```

构建broker容器

```
docker run -d  \
--restart=always \
--name rmqbroker \
--link rmqnamesrv:namesrv \
-p 10911:10911 \
-p 10909:10909 \
-v  /mydata/rocketmq/data/broker/logs:/root/logs \
-v  /mydata/rocketmq/data/broker/store:/root/store \
-v /mydata/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \
-e "NAMESRV_ADDR=namesrv:9876" \
-e "MAX_POSSIBLE_HEAP=200000000" \
foxiswho/rocketmq:4.8.0 \
sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf 

```

创建rockermq-console服务

```
docker run -d \
--restart=always \
--name rmqadmin \
-e "JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.19.134:9876 \
-Dcom.rocketmq.sendMessageWithVIPChannel=false" \
-p 9999:8080 \
styletang/rocketmq-console-ng

```

```
docker stop rmqnamesrv
docker stop rmqbroker
docker stop rmqadmin


docker rm rmqnamesrv
docker rm rmqbroker
docker rm rmqadmin

```

